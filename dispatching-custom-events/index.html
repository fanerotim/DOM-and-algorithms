<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dispatching custom events</title>
</head>

<body>

    <style>
        img {
            margin-top: 1rem;
            width: 400px;
        }
    </style>

    <h1 id="heading">It is snowing!</h1>

    <!-- HIDE IMAGE EXAMPLE -->
    <button onclick="hideImage()">Hide image</button>
    <button id="nested" onclick="nestedHandler()">Nested custom events</button>
    <img id="image" src="/assets/image.jpg" alt="Paris Olympics 5000m women, final">
    
    <script>
        // if event is bubble is true & default behavior is allowed I will catch the custom event 
        document.addEventListener('snowing', (e) => {
            console.log('event bubbled', e)
        })

        heading.addEventListener('snowing', (e) => {
            console.log(heading.textContent);
            // even if event is allowed to bubble, we can still prevent default browser behavior and stop the bubble
            // e.stopPropagation();
        })

        // if the event is standard user generated one then e.isTrusted is true. in custom events that prop is false
        heading.addEventListener('click', (e) => {
            console.log(e.isTrusted);
        })

        // if bubbles is set to true, the event bubbles up. in this case, event handler on document catches it
        const event = new Event('snowing', { bubbles: true, cancelable: true });
        heading.dispatchEvent(event);

        // HIDE IMAGE EXAMPLE
        // testing preventDefault() to send a signal / data on how to proceeed

        // listen for custom event 
        image.addEventListener('image', (e) => {
            // ask user to confirm that they want to hide the image
            if (!confirm('Hide image?')) {
                alert('we will not be hiding image');
                // prevent default means that inside hideImage() hide will be false, sa dispachEvent returns false
                e.preventDefault();
            }
        })

        // when buttons is clicked to hide the image, dispatch a custom event
        const hideImage = () => {
            // create a new event and allow it to be prevented with e.preventDefault();
            const imageEvent = new CustomEvent('image', { cancelable: true })
            // check if event was cancelled
            const hide = image.dispatchEvent(imageEvent);

            // if it was not, then we hide the image
            if (hide) {
                image.hidden = 'true'
            }
        }

        // NESTED EVENTS EXECUTION EXAMPLE

        // create handler for the nested button onclick
        // and examine execution order
        const nestedHandler = (e) => {
            // first executes this line
            alert('start');

            // then we create and dispatch a custom event
            // if I move this block below the last alert then its handler will execute last
            // or we can wrap the dispatch event into a setTimout() with 0 delay to create an async request, which again will change execution order - custom handler executes last
            const event = new Event('nested', {bubbles: true});
            nested.dispatchEvent(event);

            // this line executes last
            alert('end')
        }

        // we catch the custom event
        nested.addEventListener('nested', () => {
            // this line executes before the end of the nestedHandler fn;
            alert('Nested event executed!')
        })

    </script>
</body>

</html>